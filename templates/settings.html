{% extends "base_tw.html" %}

{% block title %}Ayarlar - CmmntLnd{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold mb-6">Ayarlar</h1>
<form method="POST" class="space-y-8">
  <!-- Google Play -->
  <div class="bg-gray-800 rounded-xl shadow p-6">
    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2"><i class="fab fa-google-play text-green-500"></i> Google Play Store</h2>
    <div class="grid md:grid-cols-2 gap-6">
      <div>
        <label for="google_play_app_id" class="block text-sm font-medium mb-1">App ID</label>
        <input id="google_play_app_id" name="google_play_app_id" value="{{ config.get('GOOGLE_PLAY_APP_ID','') }}" placeholder="com.whatsapp" type="text" class="w-full rounded-md bg-gray-900 border-gray-700 focus:border-emerald-500 focus:ring-emerald-500" />
        <p class="text-xs text-gray-400 mt-1">Örnek: com.whatsapp, com.facebook, com.instagram</p>
      </div>
      <div>
        <label for="google_play_country" class="block text-sm font-medium mb-1">Ülke</label>
        <select id="google_play_country" name="google_play_country" class="w-full rounded-md bg-gray-900 border-gray-700 focus:border-emerald-500 focus:ring-emerald-500">
          <option value="all" {{ 'selected' if config.get('GOOGLE_PLAY_COUNTRY')=='all' else '' }}>🌍 Tüm Ülkeler</option>
          <option value="tr" {{ 'selected' if config.get('GOOGLE_PLAY_COUNTRY')=='tr' else '' }}>🇹🇷 Türkiye</option>
          <option value="us" {{ 'selected' if config.get('GOOGLE_PLAY_COUNTRY')=='us' else '' }}>🇺🇸 ABD</option>
          <option value="gb" {{ 'selected' if config.get('GOOGLE_PLAY_COUNTRY')=='gb' else '' }}>🇬🇧 İngiltere</option>
        </select>
      </div>
    </div>
  </div>

  <!-- App Store -->
  <div class="bg-gray-800 rounded-xl shadow p-6">
    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2"><i class="fab fa-apple text-gray-300"></i> App Store</h2>
    <div class="grid md:grid-cols-2 gap-6">
      <div>
        <label for="app_store_app_id" class="block text-sm font-medium mb-1">App ID</label>
        <input id="app_store_app_id" name="app_store_app_id" value="{{ config.get('APP_STORE_APP_ID','') }}" placeholder="310633997" type="text" class="w-full rounded-md bg-gray-900 border-gray-700 focus:border-emerald-500 focus:ring-emerald-500" />
        <p class="text-xs text-gray-400 mt-1">Örnek: 310633997 (WhatsApp)</p>
      </div>
      <div>
        <label for="app_store_country" class="block text-sm font-medium mb-1">Ülke</label>
        <select id="app_store_country" name="app_store_country" class="w-full rounded-md bg-gray-900 border-gray-700 focus:border-emerald-500 focus:ring-emerald-500">
          <option value="all" {{ 'selected' if config.get('APP_STORE_COUNTRY')=='all' else '' }}>🌍 Tüm Ülkeler</option>
          <option value="tr" {{ 'selected' if config.get('APP_STORE_COUNTRY')=='tr' else '' }}>🇹🇷 Türkiye</option>
          <option value="us" {{ 'selected' if config.get('APP_STORE_COUNTRY')=='us' else '' }}>🇺🇸 ABD</option>
          <option value="gb" {{ 'selected' if config.get('APP_STORE_COUNTRY')=='gb' else '' }}>🇬🇧 İngiltere</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Slack -->
  <div class="bg-gray-800 rounded-xl shadow p-6">
    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2"><i class="fab fa-slack text-indigo-400"></i> Slack</h2>
    <div class="grid md:grid-cols-2 gap-6">
      <div class="md:col-span-2">
        <label for="slack_webhook_url" class="block text-sm font-medium mb-1">Webhook URL</label>
        <input id="slack_webhook_url" name="slack_webhook_url" value="{{ config.get('SLACK_WEBHOOK_URL','') }}" placeholder="https://hooks.slack.com/services/..." type="url" class="w-full rounded-md bg-gray-900 border-gray-700 focus:border-emerald-500 focus:ring-emerald-500" />
      </div>
      <div>
        <label for="slack_channel" class="block text-sm font-medium mb-1">Kanal</label>
        <input id="slack_channel" name="slack_channel" value="{{ config.get('SLACK_CHANNEL','#app-reviews') }}" placeholder="#app-reviews" type="text" class="w-full rounded-md bg-gray-900 border-gray-700 focus:border-emerald-500 focus:ring-emerald-500" />
      </div>
      <div class="flex items-end">
        <button type="button" onclick="testSlack()" class="inline-flex items-center gap-2 px-4 py-2 rounded-md bg-blue-600 hover:bg-blue-700 text-white">
          <i class="fa-solid fa-paper-plane"></i> Test Et
        </button>
      </div>
    </div>
  </div>

  <!-- Monitor settings -->
  <div class="bg-gray-800 rounded-xl shadow p-6">
    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2"><i class="fa-solid fa-clock text-yellow-400"></i> İzleme</h2>
    <div class="grid md:grid-cols-2 gap-6">
      <div>
        <label for="check_interval" class="block text-sm font-medium mb-1">Kontrol Aralığı (dk)</label>
        <select id="check_interval" name="check_interval" class="w-full rounded-md bg-gray-900 border-gray-700 focus:border-emerald-500 focus:ring-emerald-500">
          {% for v,label in [('5','5'),('15','15'),('30','30'),('60','60')] %}
          <option value="{{ v }}" {{ 'selected' if config.get('CHECK_INTERVAL_MINUTES')==v else '' }}>{{ label }} dk</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label for="max_reviews" class="block text-sm font-medium mb-1">Maksimum Yorum</label>
        <select id="max_reviews" name="max_reviews" class="w-full rounded-md bg-gray-900 border-gray-700 focus:border-emerald-500 focus:ring-emerald-500">
          {% for v in ['5','10','20','50'] %}
          <option value="{{ v }}" {{ 'selected' if config.get('MAX_REVIEWS_PER_CHECK')==v else '' }}>{{ v }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="flex justify-between flex-wrap gap-4">
    <a href="{{ url_for('index') }}" class="inline-flex items-center gap-2 px-5 py-2 rounded-md bg-gray-700 hover:bg-gray-600 text-white"><i class="fa-solid fa-arrow-left"></i> Ana Sayfa</a>
    <button type="submit" class="inline-flex items-center gap-2 px-6 py-3 rounded-md bg-emerald-600 hover:bg-emerald-700 text-white"><i class="fa-solid fa-save"></i> Kaydet</button>
  </div>
</form>

{% endblock %}

{% block extra_scripts %}
<script>
function testSlack(){const url=document.getElementById('slack_webhook_url').value;if(!url){alert('Webhook URL girin');return;}const fd=new FormData();fd.append('webhook_url',url);fetch('/test_slack',{method:'POST',body:fd}).then(r=>r.json()).then(d=>{alert(d.success?'✅ Başarılı':'❌ '+d.message)}).catch(e=>alert(e.message));}
</script>
{% endblock %}