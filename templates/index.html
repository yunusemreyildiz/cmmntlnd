{% extends "base_tw.html" %}

{% block content %}
<!-- Hero -->
<section class="text-center mb-8">
  <h1 class="text-4xl font-bold tracking-tight mb-2">CmmntLnd</h1>
  <p class="text-gray-400">Google Play & App Store yorumlarını anlık takip edin</p>
</section>

<!-- Monitor Status -->
<div class="grid lg:grid-cols-3 gap-6 mb-8">
  <div class="col-span-3 bg-gray-800 rounded-xl shadow-md p-6 flex flex-col md:flex-row items-center justify-between">
    <div class="flex items-center gap-4">
      <div class="h-14 w-14 flex items-center justify-center rounded-full {{ 'bg-green-600' if monitor_running else 'bg-red-600' }} text-white">
        <i class="fa-solid fa-{{ 'play' if monitor_running else 'pause' }}"></i>
      </div>
      <div>
        <h3 class="text-lg font-semibold">Monitor Durumu</h3>
        <span class="inline-flex items-center gap-2 text-sm {{ 'text-green-400' if monitor_running else 'text-red-400' }}">
          <i class="fa-solid fa-circle text-xs"></i>
          {{ 'Çalışıyor' if monitor_running else 'Durduruldu' }}
        </span>
      </div>
    </div>
    <div class="flex gap-3 mt-4 md:mt-0">
      {% if not monitor_running %}
      <button onclick="startMonitor()" class="inline-flex items-center gap-2 px-5 py-2 rounded-md bg-green-600 hover:bg-green-700 text-white">
        <i class="fa-solid fa-play"></i> Başlat
      </button>
      {% else %}
      <button onclick="stopMonitor()" class="inline-flex items-center gap-2 px-5 py-2 rounded-md bg-red-600 hover:bg-red-700 text-white">
        <i class="fa-solid fa-stop"></i> Durdur
      </button>
      {% endif %}
      <a href="{{ url_for('settings') }}" class="inline-flex items-center gap-2 px-5 py-2 rounded-md bg-gray-700 hover:bg-gray-600 text-white">
        <i class="fa-solid fa-cog"></i> Ayarlar
      </a>
    </div>
  </div>
</div>

<!-- App info cards -->
<div class="grid md:grid-cols-3 gap-6 mb-8">
  <!-- Google Play -->
  <div class="bg-gray-800 rounded-xl shadow p-6 flex flex-col items-center text-center">
    <i class="fab fa-google-play text-4xl text-green-500 mb-4"></i>
    <h4 class="font-semibold mb-1">Google Play Store</h4>
    <p class="text-sm text-gray-400 mb-3">Android uygulaması</p>
    <code class="break-all bg-gray-900/50 px-2 py-1 rounded text-sm">{{ config.get('GOOGLE_PLAY_APP_ID', 'Ayarlanmamış') }}</code>
  </div>
  <!-- App Store -->
  <div class="bg-gray-800 rounded-xl shadow p-6 flex flex-col items-center text-center">
    <i class="fab fa-apple text-4xl text-gray-300 mb-4"></i>
    <h4 class="font-semibold mb-1">App Store</h4>
    <p class="text-sm text-gray-400 mb-3">iOS uygulaması</p>
    <code class="break-all bg-gray-900/50 px-2 py-1 rounded text-sm">{{ config.get('APP_STORE_APP_ID', 'Ayarlanmamış') }}</code>
  </div>
  <!-- Slack -->
  <div class="bg-gray-800 rounded-xl shadow p-6 flex flex-col items-center text-center">
    <i class="fab fa-slack text-4xl text-indigo-400 mb-4"></i>
    <h4 class="font-semibold mb-1">Slack Kanalı</h4>
    <p class="text-sm text-gray-400 mb-3">Bildirim kanalı</p>
    <code class="break-all bg-gray-900/50 px-2 py-1 rounded text-sm">{{ config.get('SLACK_CHANNEL', '#app-reviews') }}</code>
  </div>
</div>

<!-- Logs and Quick guide -->
<div class="grid lg:grid-cols-3 gap-6">
  <!-- Logs -->
  <div class="lg:col-span-2">
    <div class="bg-gray-800 rounded-xl shadow">
      <div class="border-b border-gray-700 px-6 py-4 flex items-center justify-between">
        <h3 class="font-semibold">Canlı Loglar</h3>
      </div>
      <div class="p-4 h-96 overflow-y-auto space-y-3 text-sm" id="log-container">
        {% for log in logs %}
        <div class="px-4 py-2 rounded-md {{ 'border-l-4 border-green-500' if log.level=='success' else 'border-l-4 border-red-500' if log.level=='error' else 'border-l-4 border-blue-500' }} bg-gray-700/50">
          <span class="text-gray-400 mr-2">{{ log.timestamp }}</span>{{ log.message }}
        </div>
        {% endfor %}
        {% if not logs %}
        <div class="text-center text-gray-400">Henüz log yok. Monitor'u başlatın.</div>
        {% endif %}
      </div>
    </div>
  </div>
  <!-- Quick guide -->
  <div class="space-y-6">
    <div class="bg-gray-800 rounded-xl shadow p-6">
      <h3 class="font-semibold mb-4">Hızlı Başlangıç</h3>
      <ol class="list-decimal list-inside space-y-2 text-gray-300 text-sm">
        <li>Ayarlar sayfasında App ID ve Slack webhook gir.</li>
        <li>Slack bağlantısını test et.</li>
        <li>Monitor'u başlat.</li>
        <li>Yeni yorumları takip et!</li>
      </ol>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
function startMonitor(){fetch('/start_monitor',{method:'POST'}).then(r=>r.json()).then(d=>{d.success?location.reload():alert('Hata: '+d.message)});}
function stopMonitor(){fetch('/stop_monitor',{method:'POST'}).then(r=>r.json()).then(d=>{d.success?location.reload():alert('Hata: '+d.message)});}
// Auto refresh logs
setInterval(()=>{fetch('/logs').then(r=>r.json()).then(logs=>{const c=document.getElementById('log-container');if(!c)return;c.innerHTML=logs.map(l=>`<div class='px-4 py-2 rounded-md ${l.level==='success'?'border-l-4 border-green-500':'error'?'border-l-4 border-red-500':'border-l-4 border-blue-500'} bg-gray-700/50'><span class='text-gray-400 mr-2'>${l.timestamp}</span>${l.message}</div>`).join('');c.scrollTop=c.scrollHeight;});},5000);
</script>
{% endblock %}
